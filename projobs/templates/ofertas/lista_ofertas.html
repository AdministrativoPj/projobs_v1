{% extends 'baseperfil.html' %}
{# Hereda de la plantilla base del perfil para mantener la estructura del layout #}

{% load static %}
{# Carga archivos est치ticos como CSS/JS desde la configuraci칩n de Django #}

{% block extra_css %}
  <link rel="stylesheet" href="{% static 'css/style_postular_oferta.css' %}">
  {# Enlace al archivo CSS espec칤fico para estilos de postulaci칩n a ofertas #}
{% endblock %}

{% block content %}
<div class="ofertas-container">
  <h2>Ofertas laborales disponibles</h2>

  <!-- 游댠 Filtro por categor칤a de servicios -->
  <form method="get" class="filtro-form">
    <label for="categoria">Filtrar por categor칤a:</label>
    <select name="categoria" id="categoria" onchange="this.form.submit()">
      <option value="">Todas</option>
      {# Lista de opciones. Si el usuario ha seleccionado una categor칤a, esa opci칩n se marca como seleccionada #}
      <option value="Administrador" {% if categoria_seleccionada == "Administrador" %}selected{% endif %}>Administrador</option>
      ...
      <option value="Vigilante" {% if categoria_seleccionada == "Vigilante" %}selected{% endif %}>Vigilante</option>
      <option value="Otro" {% if categoria_seleccionada == "Otro" %}selected{% endif %}>Otro</option>
    </select>
  </form>

  <!-- Mensajes del sistema (칠xito, error, etc.) -->
  {% for message in messages %}
    <div class="msg">{{ message }}</div>
  {% endfor %}

  <!-- Renderizado de las ofertas -->
  {% if ofertas %}
    <div class="contenedor-ofertas">
      {% for oferta in ofertas %}
        <div class="oferta-card {% if oferta.estado != 'abierta' %}cerrada{% endif %}">
          {# Si la oferta est치 cerrada, se agrega una clase que la desactiva visualmente #}

          <div class="oferta-titulo">{{ oferta.titulo }}</div>

          <div class="oferta-info">
            <p><strong>Ubicaci칩n:</strong> {{ oferta.ubicacion }}</p>
            <p><strong>Modo de trabajo:</strong> {{ oferta.get_modo_trabajo_display }}</p>
            <p><strong>Rango de pago:</strong> {{ oferta.rango_pago }}</p>
            <p><strong>Fecha l칤mite:</strong> {{ oferta.fecha_limite }}</p>
            <p><strong>Categor칤a:</strong> {{ oferta.categoria }}</p>

            {% if oferta.categoria == "Otro" and oferta.descripcion_profesion %}
              <p><strong>Espec칤fico:</strong> {{ oferta.descripcion_profesion }}</p>
              {# Si la categor칤a es "Otro", se muestra la descripci칩n detallada proporcionada #}
            {% endif %}

            <p><strong>Publicado:</strong> {{ oferta.fecha_publicacion|date:"d M Y" }}</p>
          </div>

          <div class="oferta-desc">{{ oferta.descripcion }}</div>

          <div class="oferta-contador">
            {{ oferta.num_postulaciones }} postulados / {{ oferta.max_postulaciones }} m치ximo
          </div>

          {% if oferta.estado == 'abierta' %}
            {# Solo se muestra el bot칩n de postularse si la oferta est치 abierta #}
            <form method="post">
              {% csrf_token %}
              <input type="hidden" name="id_oferta" value="{{ oferta.id }}">
              <button type="submit" class="postular-btn">Postularme</button>
            </form>
          {% else %}
            <div class="cerrada-label">Oferta cerrada</div>
          {% endif %}
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No hay ofertas disponibles por el momento.</p>
  {% endif %}
</div>
{% endblock %}
